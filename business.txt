Business Logic cá»§a OrderProcessingService
Tá»•ng quan
Dá»‹ch vá»¥ OrderProcessingService chá»‹u trÃ¡ch nhiá»‡m xá»­ lÃ½ Ä‘Æ¡n hÃ ng (Order) cá»§a ngÆ°á»i dÃ¹ng. NÃ³ láº¥y danh sÃ¡ch Ä‘Æ¡n hÃ ng tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u, thá»±c hiá»‡n cÃ¡c thao tÃ¡c khÃ¡c nhau dá»±a trÃªn loáº¡i Ä‘Æ¡n hÃ ng, vÃ  cáº­p nháº­t láº¡i tráº¡ng thÃ¡i (status) cÅ©ng nhÆ° má»©c Ä‘á»™ Æ°u tiÃªn (priority) vÃ o database.

Chi Tiáº¿t Business Logic
1. Input Ä‘áº§u vÃ o
Há»‡ thá»‘ng nháº­n User ID vÃ  thá»±c hiá»‡n cÃ¡c bÆ°á»›c sau:

Láº¥y danh sÃ¡ch Order tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u (DatabaseService).

Láº·p qua tá»«ng Order Ä‘á»ƒ xá»­ lÃ½ theo loáº¡i Ä‘Æ¡n hÃ ng (type).

Cáº­p nháº­t status vÃ  priority cá»§a Order.

Ghi láº¡i tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u.

2. Quy trÃ¬nh xá»­ lÃ½ tá»«ng loáº¡i Order
ğŸ”¹ Loáº¡i A - Xuáº¥t file CSV
âœ… Äiá»u kiá»‡n: type = 'A'
âœ… HÃ nh Ä‘á»™ng:

Xuáº¥t Ä‘Æ¡n hÃ ng ra file CSV.

Náº¿u amount > 150, ghi thÃªm dÃ²ng ghi chÃº "High value order".

Náº¿u file ghi thÃ nh cÃ´ng â†’ status = exported.

Náº¿u lá»—i khi ghi file â†’ status = export_failed.

âœ… Má»©c Ä‘á»™ Æ°u tiÃªn (priority)

amount > 200 â†’ priority = high

NgÆ°á»£c láº¡i â†’ priority = low

âœ… Cáº­p nháº­t vÃ o database

Náº¿u cáº­p nháº­t thÃ nh cÃ´ng â†’ giá»¯ nguyÃªn tráº¡ng thÃ¡i.

Náº¿u cáº­p nháº­t tháº¥t báº¡i â†’ status = db_error.

ğŸ”¹ Loáº¡i B - Gá»i API xá»­ lÃ½
âœ… Äiá»u kiá»‡n: type = 'B'
âœ… HÃ nh Ä‘á»™ng:

Gá»i API bÃªn ngoÃ i (APIClient->callAPI($orderId)).

Náº¿u API tráº£ vá» "success":

Náº¿u apiResponse->data >= 50 vÃ  amount < 100 â†’ status = processed

Náº¿u apiResponse->data < 50 hoáº·c flag = true â†’ status = pending

NgÆ°á»£c láº¡i â†’ status = error

Náº¿u API tháº¥t báº¡i â†’ status = api_error

Náº¿u xáº£y ra lá»—i trong API (exception) â†’ status = api_failure

âœ… Má»©c Ä‘á»™ Æ°u tiÃªn (priority)

amount > 200 â†’ priority = high

NgÆ°á»£c láº¡i â†’ priority = low

âœ… Cáº­p nháº­t vÃ o database

Náº¿u cáº­p nháº­t thÃ nh cÃ´ng â†’ giá»¯ nguyÃªn tráº¡ng thÃ¡i.

Náº¿u cáº­p nháº­t tháº¥t báº¡i â†’ status = db_error.

ğŸ”¹ Loáº¡i C - Xá»­ lÃ½ ná»™i bá»™
âœ… Äiá»u kiá»‡n: type = 'C'
âœ… HÃ nh Ä‘á»™ng:

Náº¿u flag = true â†’ status = completed

Náº¿u flag = false â†’ status = in_progress

âœ… Má»©c Ä‘á»™ Æ°u tiÃªn (priority)

amount > 200 â†’ priority = high

NgÆ°á»£c láº¡i â†’ priority = low

âœ… Cáº­p nháº­t vÃ o database

Náº¿u cáº­p nháº­t thÃ nh cÃ´ng â†’ giá»¯ nguyÃªn tráº¡ng thÃ¡i.

Náº¿u cáº­p nháº­t tháº¥t báº¡i â†’ status = db_error.

ğŸ”¹ Loáº¡i KhÃ´ng XÃ¡c Äá»‹nh (Unknown Type)
âœ… Äiá»u kiá»‡n: Order cÃ³ type khÃ´ng há»£p lá»‡
âœ… HÃ nh Ä‘á»™ng:

status = unknown_type

priority = low

Cáº­p nháº­t vÃ o database.

3. Xá»­ lÃ½ lá»—i & Exception
Lá»—i API (APIException): status = api_failure

Lá»—i database (DatabaseException): status = db_error

Lá»—i file (CSV): status = export_failed

Lá»—i há»‡ thá»‘ng chung (Exception): Tráº£ vá» false

TÃ³m Táº¯t Quy TrÃ¬nh
Order Type	HÃ nh Äá»™ng	Äiá»u Kiá»‡n ChÃ­nh	Status Káº¿t Quáº£
A	Xuáº¥t CSV	File ghi thÃ nh cÃ´ng	exported
A	Xuáº¥t CSV	Lá»—i ghi file	export_failed
B	Gá»i API	apiResponse->data >= 50 && amount < 100	processed
B	Gá»i API	`apiResponse->data < 50	
B	Gá»i API	API lá»—i	api_error / api_failure
C	Xá»­ lÃ½ ná»™i bá»™	flag = true	completed
C	Xá»­ lÃ½ ná»™i bá»™	flag = false	in_progress
Unknown	KhÃ´ng há»£p lá»‡	KhÃ´ng xÃ¡c Ä‘á»‹nh	unknown_type

Dá»¯ liá»‡u Ä‘áº§u ra:
- TrÆ°á»ng há»£p cÃ³ orders, tráº£ vá» danh sÃ¡ch orders
- trÆ°á»ng há»£p khÃ´ng cÃ³ order, tráº£ vá» danh sÃ¡ch rá»—ng
- TrÆ°á»ng há»£p lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh, tráº£ vá» false